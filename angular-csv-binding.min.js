"use strict";angular.module("csvBinding",[]).directive("csv",[function(){return{require:"ngModel",restrict:"CA",scope:{delimiter:"=",hasHeaders:"="},link:function(a,b,c,d){function f(b){var c=a.delimiter||",",d=angular.isDefined(a.hasHeaders)?a.hasHeaders:!0;if(-1==b.indexOf(c))return[];e=[];for(var f=new RegExp("(\\"+c+"|\\r?\\n|\\r|^)"+'(?:"([^"]*(?:""[^"]*)*)"|'+'([^"\\'+c+"\\r\\n]*))","gi"),g=[[]],h=null,i=0;h=f.exec(b);){var j=h[1];if(j.length&&j!=c&&(1==g.length&&d&&!e.length&&(e=g[0].slice(0),g.splice(0,1)),g.push(e.length?{}:[]),i=0),h[2])var k=h[2].replace(new RegExp('""',"g"),'"');else var k=h[3];var l=g[g.length-1];0!==e.length?l[e[i]]=k:l.push(k),i++}return g}function h(b){var c=a.delimiter||",",d=angular.isDefined(a.hasHeaders)?a.hasHeaders:!0,f=[];if(d){var g=angular.copy(e);angular.forEach(b,function(a){angular.forEach(a,function(a,b){-1==g.indexOf(b)&&g.push(b)})}),f.push(g.join(c))}return angular.forEach(b,function(a){var b=[];d?angular.forEach(g,function(c){b.push(a[c]||"")}):angular.forEach(a,function(a){b.push(a)}),f.push(b.join(c))}),f.join("\n")}a.delimiter==a.delimiter||",",a.hasHeaders==angular.isDefined(a.hasHeaders)?a.hasHeaders:!0;var e=[],g=function(a){try{var b=f(a);return b}catch(c){return console.log(c),a}};d.$parsers.unshift(g),d.$formatters.push(h);var i=function(){var b=d.$modelValue;if(null!=b&&b.length){for(var c in d.$formatters)b=d.$formatters[c](b);d.$viewValue=b,d.$render()}};a.$watch("delimiter",i),a.$watch("hasHeaders",i)}}}]);