"use strict";angular.module("csvBinding",[]).directive("csv",[function(){return{require:"ngModel",restrict:"CA",scope:{delimiter:"=",hasHeaders:"="},link:function(a,b,c,d){function e(b){for(var c=a.delimiter||",",d=angular.isDefined(a.hasHeaders)?a.hasHeaders:!0,e=[],f=new RegExp("(\\"+c+"|\\r?\\n|\\r|^)"+'(?:"([^"]*(?:""[^"]*)*)"|'+'([^"\\'+c+"\\r\\n]*))","gi"),g=[[]],h=null,i=0;h=f.exec(b);){var j=h[1];if(j.length&&j!=c&&(1==g.length&&d&&!e.length&&(e=g[0].slice(0),g.splice(0,1)),g.push(e.length?{}:[]),i=0),h[2])var k=h[2].replace(new RegExp('""',"g"),'"');else var k=h[3];var l=g[g.length-1];0!==e.length?l[e[i]]=k:l.push(k),i++}return g}function g(b){var c=a.delimiter||",",d=angular.isDefined(a.hasHeaders)?a.hasHeaders:!0,e=[];if(d){var f=[];angular.forEach(b,function(a){angular.forEach(a,function(a,b){-1==f.indexOf(b)&&f.push(b)})}),e.push(f.join(c))}return angular.forEach(b,function(a){var b=[];d?angular.forEach(f,function(c){b.push(a[c]||"")}):angular.forEach(a,function(a){b.push(a)}),e.push(b.join(c))}),e.join("\n")}a.delimiter==a.delimiter||",",a.hasHeaders==angular.isDefined(a.hasHeaders)?a.hasHeaders:!0;var f=function(a){try{var b=e(a);return b}catch(c){return console.log(c),a}};d.$parsers.unshift(f),d.$formatters.push(g);var h=function(){var b=d.$modelValue;if(null!=b&&b.length){for(var c in d.$formatters)b=d.$formatters[c](b);d.$viewValue=b,d.$render()}};a.$watch("delimiter",h),a.$watch("hasHeaders",h)}}}]);